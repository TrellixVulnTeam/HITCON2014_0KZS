/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2009 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Data declarations

extern _UNKNOWN start; // weak
extern char file[]; // idb
extern int (*_frame_dummy_init_array_entry[2])(); // weak
extern int (*_do_global_dtors_aux_fini_array_entry)(); // weak
extern char _bss_start; // weak
extern _UNKNOWN unk_804A043; // weak
// extern _UNKNOWN _gmon_start__; weak

//-------------------------------------------------------------------------
// Function declarations

int __cdecl init_proc();
ssize_t read(int fd, void *buf, size_t nbytes);
time_t time(time_t *timer);
unsigned int alarm(unsigned int seconds);
int __gmon_start__(void); // weak
int open(const char *file, int oflag, ...);
void srand(unsigned int seed);
ssize_t write(int fd, const void *buf, size_t n);
void *memset(void *s, int c, size_t n);
int rand(void);
int close(int fd);
void __cdecl _x86_get_pc_thunk_bx();
unsigned int __cdecl deregister_tm_clones();
int __cdecl register_tm_clones();
void __cdecl _do_global_dtors_aux();
int __cdecl frame_dummy();
void __cdecl init();
int __cdecl read_80_bytes(void *buf); // idb
int __cdecl main();
int __cdecl _libc_csu_init(int a1, int a2, int a3);
void __cdecl term_proc();


//----- (080483AC) --------------------------------------------------------
int __cdecl init_proc()
{
  int result; // eax@1

  result = (int)&_gmon_start__;
  if ( &_gmon_start__ )
    result = __gmon_start__();
  return result;
}
// 8048410: using guessed type int __gmon_start__(void);

//----- (08048490) --------------------------------------------------------
#error "8048493: positive sp value has been found (funcsize=2)"

//----- (080484C0) --------------------------------------------------------
void __cdecl _x86_get_pc_thunk_bx()
{
  ;
}

//----- (080484D0) --------------------------------------------------------
unsigned int __cdecl deregister_tm_clones()
{
  unsigned int result; // eax@1

  result = &unk_804A043 - (_UNKNOWN *)&_bss_start;
  if ( &unk_804A043 - (_UNKNOWN *)&_bss_start > 6 )
    result = 0;
  return result;
}
// 80484D0: could not find valid save-restore pair for ebp
// 804A040: using guessed type char _bss_start;

//----- (08048500) --------------------------------------------------------
int __cdecl register_tm_clones()
{
  return 0;
}
// 8048500: could not find valid save-restore pair for ebp

//----- (08048540) --------------------------------------------------------
void __cdecl _do_global_dtors_aux()
{
  if ( !_bss_start )
  {
    deregister_tm_clones();
    _bss_start = 1;
  }
  __asm { rep retn }
}
// 804A040: using guessed type char _bss_start;

//----- (08048560) --------------------------------------------------------
int __cdecl frame_dummy()
{
  return register_tm_clones();
}
// 8048560: could not find valid save-restore pair for ebp

//----- (0804858D) --------------------------------------------------------
void __cdecl init()
{
  char buf[16]; // [sp+14h] [bp-24h]@1
  int fd; // [sp+24h] [bp-14h]@1
  unsigned int seed; // [sp+28h] [bp-10h]@1
  int i; // [sp+2Ch] [bp-Ch]@1

  fd = open("/home/rsbo/flag", 0);
  read(fd, buf, 0x10u);
  seed = time(0);
  for ( i = 0; i <= 15; ++i )
    seed = (signed int)(1337 * seed + buf[i]) % 2147483647;
  close(fd);
  memset(buf, 0, 0x10u);
  srand(seed);
}
// 804858D: using guessed type char buf[16];

//----- (0804865C) --------------------------------------------------------
ssize_t __cdecl read_80_bytes(void *buf)
{
  return read(0, buf, 0x80u);
}

//----- (0804867F) --------------------------------------------------------
int __cdecl main()
{
  int v0; // eax@2
  char v2; // [sp+10h] [bp-60h]@1
  int v3; // [sp+60h] [bp-10h]@2
  int v4; // [sp+64h] [bp-Ch]@2
  size_t v5; // [sp+68h] [bp-8h]@1
  signed int i; // [sp+6Ch] [bp-4h]@1

  alarm(0x1Eu);
  init();
  v5 = read_80_bytes(&v2);
  for ( i = 0; i < (signed int)v5; ++i )
  {
    v0 = rand();
    v4 = v0 % (i + 1);
    v3 = *(&v2 + i);
    *(&v2 + i) = *(&v2 + v0 % (i + 1));
    *(&v2 + v4) = v3;
  }
  write(1, &v2, v5);
  return 0;
}

//----- (08048740) --------------------------------------------------------
int __cdecl _libc_csu_init(int a1, int a2, int a3)
{
  int result; // eax@1
  int v4; // edi@1
  signed int v5; // esi@1

  v4 = 0;
  init_proc();
  result = (int)_frame_dummy_init_array_entry;
  v5 = (signed int)((char *)&_do_global_dtors_aux_fini_array_entry - (char *)_frame_dummy_init_array_entry) >> 2;
  if ( v5 )
  {
    do
      result = ((int (__cdecl *)(int, int, int))_frame_dummy_init_array_entry[v4++])(a1, a2, a3);
    while ( v4 != v5 );
  }
  return result;
}
// 8049F08: using guessed type int (*_frame_dummy_init_array_entry[2])();
// 8049F0C: using guessed type int (*_do_global_dtors_aux_fini_array_entry)();

//----- (080487B4) --------------------------------------------------------
void __cdecl term_proc()
{
  ;
}

#error "There were 1 decompilation failure(s) on 12 function(s)"
